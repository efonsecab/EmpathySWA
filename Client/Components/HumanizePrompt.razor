@using Microsoft.JSInterop
@inject IJSRuntime JS

<div class="humanize-prompt">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="mb-0">@Title</h5>
        <div>
            <button class="btn btn-sm btn-outline-secondary me-2" @onclick="Print">Imprimir</button>
            <button class="btn btn-sm btn-outline-primary" @onclick="ToggleCompact">@(!Compact ? "Versión compacta" : "Versión detallada")</button>
        </div>
    </div>

    <div class="row">
        @foreach (var p in Prompts)
        {
            <div class="col-12 col-md-6 mb-3">
                <div class="card h-100 printable-card">
                    <div class="card-body d-flex flex-column">
                        <h6 class="card-title">@p.Title</h6>
                        @if (!string.IsNullOrEmpty(p.Description))
                        {
                            <p class="small text-muted mb-2">@((MarkupString)p.Description)</p>
                        }

                        @if (!Compact)
                        {
                            <textarea class="form-control flex-grow-1" rows="5" placeholder="Escribe aquí..." />
                        }
                        else
                        {
                            <input class="form-control" placeholder="Escribe breve..." />
                        }

                    </div>
                </div>
            </div>
        }
    </div>
</div>

@code {
    /// <summary>
    /// Título mostrado en la cabecera del componente.
    /// </summary>
    [Parameter]
    public string Title { get; set; } = "Humanizar: plantillas para la sesión";

    /// <summary>
    /// Lista de plantillas que se mostrarán como tarjetas para imprimir o completar en sesión.
    /// </summary>
    [Parameter]
    public List<PromptTemplate> Prompts { get; set; } = new List<PromptTemplate>
    {
        new PromptTemplate { Title = "Nombre y rol", Description = "Nombre, edad o rol relevante (ej.: madre, compañero de trabajo)." },
        new PromptTemplate { Title = "Historia breve", Description = "2–3 oraciones que describan un evento o contexto importante en su vida." },
        new PromptTemplate { Title = "Preocupaciones actuales", Description = "Qué le preocupa hoy; factores prácticos o emocionales." },
        new PromptTemplate { Title = "Fortalezas y recursos", Description = "Habilidades, apoyos o recursos que tiene la persona." },
        new PromptTemplate { Title = "Qué necesita ahora", Description = "Necesidad inmediata (escucha, descanso, ayuda práctica)." },
        new PromptTemplate { Title = "Pequeñas acciones que puedo hacer", Description = "Lista de 1–3 acciones concretas y no invasivas que puedo ofrecer." }
    };

    /// <summary>
    /// Modo compacto para mostrar campos más breves (útil al imprimir muchas tarjetas por página).
    /// </summary>
    public bool Compact { get; set; }

    private void ToggleCompact() => Compact = !Compact;

    private async Task Print()
    {
        // Usa la API del navegador para imprimir la página; el CSS de impresión puede adaptarse en wwwroot si se desea.
        await JS.InvokeVoidAsync("window.print");
    }

    /// <summary>
    /// Plantilla que representa un prompt/tarjeta de humanización.
    /// </summary>
    public class PromptTemplate
    {
        /// <summary>
        /// Título breve de la tarjeta (ej.: "Nombre y rol").
        /// </summary>
        public string Title { get; set; } = string.Empty;

        /// <summary>
        /// Descripción o instrucciones cortas que aparecen bajo el título. Puede contener HTML mínimo.
        /// </summary>
        public string Description { get; set; } = string.Empty;
    }
}
